![[jpa1.jpg]]

ORM is a technique that lets us interact with a database using objects in programming language instead of writing raw SQL.

It automatically maps database tables → to classes, and rows → to objects.

One liner: "ORM is a way to map Java objects to database tables so that developers can work with objects instead of SQL queries. Hibernate is a popular ORM framework in Java."

Example:  
Without ORM:
```sql
SELECT * FROM users WHERE id = 1;
```

With ORM (in Java using JPA/Hibernate):
```java
User user = userRepository.findById(1L).get();
```

![[jpa2.jpg]]

JPA is a specification — it defines how Java objects should map to database tables, but it doesn’t provide the actual implementation. Hibernate is one of the most popular implementations of JPA. In other words, JPA is the set of rules, and Hibernate is the tool that follows those rules to do the actual work.

JPA → Interface / Specification (What to do)
Hibernate → Implementation / Tool (How to do it)


![[jpa3.jpg]]


* `spring.jpa.hibernate.ddl-auto`
configures how Hibernate handles the database schema
![[jpa4.jpg]]


User entitity:
```java
@Entity
@Table(name = "USER")
public class User {

	@Id
	@GeneratedValue(strategy = GenerationType.AUTO)
	@Column(name = "USER_ID")
	private int id;

	@Column(name = "USERNAME")
	private String name;

	@Column(name = "CITY", length = 50)
	private String city;

	@Column(name = "AGE", length = 2)
	private int age;

	public User(int id, String name, String city, int age) {
		super();
		this.id = id;
		this.name = name;
		this.city = city;
		this.age = age;
	}
	public User() {
		super();
		// TODO Auto-generated constructor stub
	}
	public int getId() {
		return id;
	}
	public void setId(int id) {
		this.id = id;
	}
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public String getCity() {
		return city;
	}
	public void setCity(String city) {
		this.city = city;
	}
	public int getAge() {
		return age;
	}
	public void setAge(int age) {
		this.age = age;
	}
	@Override
	public String toString() {
		return "User [id=" + id + ", name=" + name + ", city=" + city + ", age=" + age + "]";
	}
}

```

User repository:
```java
@Repository
public interface UserRepository extends JpaRepository<User, Integer>{ 
}
```

User ServiceImpl:
```java
@Service
public class UserServiceImpl implements UserService {

	Logger logger = LoggerFactory.getLogger(UserServiceImpl.class);

	@Autowired
	private UserRepository userRepository;

	@Override
	public User saveUser(User user) {
		User savedUser = this.userRepository.save(user);
		logger.info("User saved: {}", savedUser.getId());
		return savedUser;
	}

	@Override
	public User updateUser(User user, int userId) {
		User existingUser = this.userRepository.findById(userId).orElseThrow(() -> new RuntimeException("User not found"));
		
		existingUser.setName(user.getName());
		existingUser.setAge(user.getAge());
		existingUser.setCity(user.getCity());
		User addedUser = this.userRepository.save(existingUser);
		
		return addedUser;
	}

	@Override
	public void deleteUser(int userId) {
		User existingUser = this.userRepository.findById(userId).orElseThrow(() -> new RuntimeException("User not found"));
		this.userRepository.delete(existingUser);

	}

	@Override
	public User getUser(int userId) {
		User user = this.userRepository.findById(userId).orElseThrow(() -> new RuntimeException("User not found"));
		logger.info("Got user: {}", user.getId());
		return user;
	}

	@Override
	public List<User> getAllUsers() {
		List<User> users = this.userRepository.findAll();
		return users;
	}
}
```
