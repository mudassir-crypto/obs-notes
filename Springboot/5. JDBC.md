![[jdbc1.jpg]]

![[jdbc2.jpg]]

![[jdbc3.jpg]]

Helper class for handling datetime:
```java
public class Helper {

	public static Date parseDate(LocalDateTime localDateTime){
		
//		Instant instant = localDateTime.toInstant(ZoneOffset.UTC);
		Instant instant = localDateTime.atZone(ZoneId.systemDefault()).toInstant();
		Date date = Date.from(instant);
		
		return date;		
	}
}
```

TodoRowMapper:
```java
public class TodoRowMapper implements RowMapper<Todo>{

	@Override
	public Todo mapRow(ResultSet rs, int rowNum) throws SQLException {
//		rs.get
		Todo todo = new Todo();
		todo.setId(rs.getInt("id"));
		todo.setTitle(rs.getString("title"));
		todo.setContent(rs.getString("content"));
		todo.setStatus(rs.getString("status"));
		todo.setCreatedDate(Helper.parseDate((LocalDateTime)rs.getObject("createdDate")));
		todo.setTodoDate(Helper.parseDate((LocalDateTime)rs.getObject("todoDate")));
		return todo;
	}

}

```


TodoDao:
```java
@Repository
public class TodoDao {
	
	Logger logger = LoggerFactory.getLogger(TodoDao.class);

	private JdbcTemplate jdbcTemplate;

	public TodoDao(@Autowired JdbcTemplate jdbcTemplate) {
		this.jdbcTemplate = jdbcTemplate;
		
//		create table if does not exist
		String createTable = "create table IF NOT EXISTS todos(id int primary key, title varchar(100) not null, content varchar(450), status varchar(10) not null, createdDate datetime, todoDate datetime);";
		int update = jdbcTemplate.update(createTable);
		logger.info("Table created: {}", update);
	}

	public JdbcTemplate getJdbcTemplate() {
		return jdbcTemplate;
	}

	public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {
		this.jdbcTemplate = jdbcTemplate;
	}
	
//	create todo
	public Todo saveTodo(Todo todo) {
		
		String insertQuery = "insert into todos(id, title, content, status, createdDate, todoDate) values(?,?,?,?,?,?)";
		int row = jdbcTemplate.update(insertQuery, todo.getId(), todo.getTitle(), todo.getContent(), todo.getStatus(), todo.getCreatedDate(), todo.getTodoDate());
		
		logger.info("JDBC Ops {} inserted", row);
		return todo;
	}
	
//	get single todo 
	public Todo getTodo(int id) {
		String query = "select * from todos where id=?";
//		Map<String, Object> todoData = jdbcTemplate.queryForMap(query, id);
		Todo todo = jdbcTemplate.queryForObject(query, new TodoRowMapper(), id);
		logger.info("TodoData: {}", todo);
		
//		Todo todo = new Todo();
//		todo.setId((int)todoData.get("id"));
//		todo.setTitle((String)todoData.get("title"));
//		todo.setContent((String)todoData.get("content"));
//		todo.setStatus((String)todoData.get("status"));
//		todo.setCreatedDate(Helper.parseDate((LocalDateTime)todoData.get("createdDate")));
//		todo.setTodoDate(Helper.parseDate((LocalDateTime)todoData.get("todoDate")));
		
//		row mapper impl
		
		
		return todo;
	}
	
//	get todos
	public List<Todo> getTodos(){
		String query = "select * from todos;";
//		List<Map<String,Object>> maps = jdbcTemplate.queryForList(query);
			List<Todo> todos = jdbcTemplate.query(query, new TodoRowMapper());
			logger.info("GetTOD0: {}", todos);
		
//		List<Todo> todos = maps.stream().map((map) -> {
//			Todo todo = new Todo();
//			todo.setId((int)map.get("id"));
//			todo.setTitle((String)map.get("title"));
//			todo.setContent((String)map.get("content"));
//			todo.setStatus((String)map.get("status"));
//			todo.setCreatedDate(Helper.parseDate((LocalDateTime)map.get("createdDate")));
//			todo.setTodoDate(Helper.parseDate((LocalDateTime)map.get("todoDate")));
//			
//			return todo;
//		}).collect(Collectors.toList());
		
		return todos;
	}
	
//	update todo
	public Todo updateTodo(int id, Todo newTodo) {
		String query = "update todos set title=?, content=?, status=?, todoDate=? where id=?;";
		int update = jdbcTemplate.update(query, newTodo.getTitle(), newTodo.getContent(), newTodo.getStatus(), newTodo.getTodoDate(), id);
		logger.info("Update: {}", update);
		newTodo.setId(id);
		return newTodo;
	}
	
//	delete todo
	public int deleteTodo(int id) {
		String query = "delete from todos where id=?;";
		int update = jdbcTemplate.update(query, id);
		logger.info("DELETE: {}", update);
		return id;
	}
	
	public void deleteMultiple(int[] ids) {
		String query = "delete from todos where id=?;";
//		one way is using forEach loop and deleting one by one
		
//		2nd is batch
		int[] ints = jdbcTemplate.batchUpdate(query, new BatchPreparedStatementSetter() {
			
			@Override
			public void setValues(PreparedStatement ps, int i) throws SQLException {
				// TODO Auto-generated method stub
				int id = ids[i];
//				that parameter indexing in JDBC starts at 1
				ps.setInt(1, id);
			}
			
			@Override
			public int getBatchSize() {
				// TODO Auto-generated method stub
				return ids.length;
			}
		});
		
		for(int i: ints) {
			logger.info("Deleted: {}", i);
		}
	}
		
}
```

RowMapper using Anonymous function:
```java
List<Todo> todos = jdbcTemplate.query(query, new RowMapper<Todo>() {

	@Override
	public Todo mapRow(ResultSet rs, int rowNum) throws SQLException {
		Todo todo = new Todo();
		todo.setId(rs.getInt("id"));
		todo.setTitle(rs.getString("title"));
		todo.setContent(rs.getString("content"));
		todo.setStatus(rs.getString("status"));
		todo.setCreatedDate(Helper.parseDate((LocalDateTime)rs.getObject("createdDate")));
todo.setTodoDate(Helper.parseDate((LocalDateTime)rs.getObject("todoDate")));
		return todo;
	}
				
});
```

RowMapper using lambda function:
```java
List<Todo> todos = jdbcTemplate.query(query, (ResultSet rs, int rowNum) -> {
	Todo todo = new Todo();
	todo.setId(rs.getInt("id"));
	todo.setTitle(rs.getString("title"));
	todo.setContent(rs.getString("content"));
	todo.setStatus(rs.getString("status"));				todo.setCreatedDate(Helper.parseDate((LocalDateTime)rs.getObject("createdDate")));		todo.setTodoDate(Helper.parseDate((LocalDateTime)rs.getObject("todoDate")));
	return todo;
});
```

